<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Soneium Mastery Dashboard v4</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b0e14; color: #e2e8f0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: #161b22; padding: 25px; border-radius: 16px; width: 380px; border: 1px solid #30363d; box-shadow: 0 8px 32px rgba(0,0,0,0.5); }
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; font-size: 0.9rem; }
        .btn-connect { background: #238636; color: white; }
        .btn-poke { background: #8957e5; color: white; }
        .btn-wrap { background: #1f6feb; color: white; }
        .btn-nft { background: #db61a2; color: white; }
        .btn-send { background: #f59e0b; color: white; }
        .btn-stop { background: #dc2626 !important; color: white; }
        .log { background: #010409; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 0.75rem; height: 140px; overflow-y: auto; margin-top: 15px; color: #7ee787; border: 1px solid #30363d; }
        .stat-box { background: #21262d; padding: 10px; border-radius: 8px; margin-top: 10px; text-align: left; font-size: 0.85rem; border: 1px solid #30363d; line-height: 1.6; }
        h3 { color: #8b949e; font-size: 0.75rem; text-transform: uppercase; margin: 20px 0 5px 0; letter-spacing: 1px; }
        .badge { background: #30363d; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; color: #8b949e; float: right; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align: center; margin-bottom: 20px;">Soneium Mastery</h2>
    <button id="connectBtn" class="btn btn-connect" onclick="connect()">Connect Wallet</button>
    
    <div id="controls" style="display:none;">
        <div class="stat-box">
            <div>NFTs Owned: <span id="nftCount" style="color:#db61a2; font-weight:bold;">0</span> <span onclick="checkNFTBalance()" style="color:#58a6ff; cursor:pointer; text-decoration:underline; font-size:0.7rem; margin-left:10px;">Refresh</span></div>
            <div style="border-top: 1px solid #30363d; margin-top:5px; padding-top:5px;">
                Session Txs: <span id="sessionTxs" style="color:#7ee787; font-weight:bold;">0</span>
            </div>
        </div>

        <h3>1. Native ETH Activity</h3>
        <button class="btn btn-send" onclick="sendSelf()">Self-Send 0.000001 ETH</button>

        <h3>2. Builder NFT (Custom)</h3>
        <button class="btn btn-nft" onclick="mintNFT()">Mint Custom NFT</button>

        <h3>3. DeFi Spammer <span class="badge">Official WETH</span></h3>
        <button class="btn btn-wrap" id="autoWrapBtn" onclick="toggleAutoWrap()" style="background:#059669;">Start Auto-Wrap (5s)</button>
        <button class="btn btn-wrap" style="background:#484f58" onclick="unwrapETH()">Unwrap All WETH</button>

        <h3>4. Low-Gas Spam <span class="badge">Custom Contract</span></h3>
        <button class="btn btn-poke" id="spamBtn" onclick="runSpam()">Start/Stop Poke</button>
    </div>

    <div class="log" id="log">Waiting for connection...</div>
</div>

<script>
    const NFT_CONTRACT = "0xe134662e9CDf904Ea3D90dB3F527054ED3687d83";
    const POKE_CONTRACT = "0xac3fa700149513bed425398f10a08767Aef138c3";
    const WETH_CONTRACT = "0x4200000000000000000000000000000000000006";
    
    const NFT_ABI = [{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}];

    let signer, spamInterval, wrapInterval;
    let isSpamming = false, isWrapping = false;
    let txCount = 0;

    async function connect() {
        if (!window.ethereum) return alert("Wallet not found!");
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        document.getElementById("controls").style.display = "block";
        document.getElementById("connectBtn").innerText = "Connected";
        addLog("Securely connected.");
        checkNFTBalance();
    }

    function addLog(msg) {
        const div = document.getElementById("log");
        div.innerHTML += `> ${msg}<br>`;
        div.scrollTop = div.scrollHeight;
    }

    function updateCounter() {
        txCount++;
        document.getElementById("sessionTxs").innerText = txCount;
    }

    async function checkNFTBalance() {
        try {
            const contract = new ethers.Contract(NFT_CONTRACT, NFT_ABI, signer);
            const address = await signer.getAddress();
            const balance = await contract.balanceOf(address);
            document.getElementById("nftCount").innerText = balance.toString();
        } catch (e) { console.log("Balance check failed"); }
    }

    // --- NEW: SELF-SEND FUNCTION ---
    async function sendSelf() {
        try {
            const address = await signer.getAddress();
            addLog("Sending ETH to yourself...");
            const tx = await signer.sendTransaction({
                to: address,
                value: ethers.utils.parseEther("0.000001")
            });
            addLog("Transfer Sent: " + tx.hash.slice(0,10));
            await tx.wait();
            addLog("Transfer Confirmed!");
            updateCounter();
        } catch (e) { addLog("Transfer failed."); }
    }

    async function mintNFT() {
        try {
            const contract = new ethers.Contract(NFT_CONTRACT, NFT_ABI, signer);
            const tx = await contract.mint();
            addLog("Minting NFT...");
            await tx.wait();
            addLog("NFT Minted!");
            updateCounter();
            checkNFTBalance();
        } catch (e) { addLog("Mint failed."); }
    }

    async function toggleAutoWrap() {
        const btn = document.getElementById("autoWrapBtn");
        if (isWrapping) {
            clearInterval(wrapInterval);
            isWrapping = false;
            btn.innerText = "Start Auto-Wrap (5s)";
            btn.classList.remove("btn-stop");
            addLog("Auto-Wrap STOPPED.");
            return;
        }
        isWrapping = true;
        btn.innerText = "STOP AUTO-WRAP";
        btn.classList.add("btn-stop");
        addLog("Auto-Wrap ACTIVE...");
        
        wrapInterval = setInterval(async () => {
            try {
                const contract = new ethers.Contract(WETH_CONTRACT, ["function deposit() public payable"], signer);
                const tx = await contract.deposit({ value: ethers.utils.parseEther("0.000001") });
                addLog("Wrap: " + tx.hash.slice(0,10));
                await tx.wait();
                updateCounter();
            } catch (e) { }
        }, 5000);
    }

    async function unwrapETH() {
        try {
            const contract = new ethers.Contract(WETH_CONTRACT, ["function withdraw(uint256 wad) public", "function balanceOf(address) view returns (uint256)"], signer);
            const bal = await contract.balanceOf(await signer.getAddress());
            const tx = await contract.withdraw(bal);
            addLog("Unwrapping WETH...");
            await tx.wait();
            updateCounter();
        } catch (e) { addLog("Unwrap failed."); }
    }

    async function runSpam() {
        const btn = document.getElementById("spamBtn");
        if (isSpamming) {
            clearInterval(spamInterval);
            isSpamming = false;
            btn.innerText = "Start/Stop Poke";
            btn.classList.remove("btn-stop");
            return;
        }
        isSpamming = true;
        btn.innerText = "STOP POKING";
        btn.classList.add("btn-stop");
        spamInterval = setInterval(async () => {
            try {
                const contract = new ethers.Contract(POKE_CONTRACT, ["function poke() public"], signer);
                const tx = await contract.poke();
                addLog("Poke: " + tx.hash.slice(0,10));
                await tx.wait();
                updateCounter();
            } catch (e) { }
        }, 4000);
    }
</script>
</body>
</html>
